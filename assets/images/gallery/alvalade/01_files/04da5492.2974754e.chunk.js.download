"use strict";(self["b-property-web-property-page__LOADABLE_LOADED_CHUNKS__"]=self["b-property-web-property-page__LOADABLE_LOADED_CHUNKS__"]||[]).push([["04da5492"],{c0e70472:function(e,t,n){n.d(t,{V:function(){return a},b:function(){return o}});var r=n("cedcabf9");const i={},a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateBasketMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NamedType",name:{kind:"Name",value:"GQLBasketInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createBasket"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"GQLBasket"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"basketId"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:153,source:{body:"\n  mutation CreateBasketMutation($input: GQLBasketInput) {\n    createBasket(input: $input) {\n      ... on GQLBasket {\n        basketId\n      }\n    }\n  }\n",name:"GraphQL request",locationOffset:{line:1,column:1}}}};function o(e){const t={...i,...e};return r.useMutation(a,t)}},bbf5929a:function(e,t,n){n.r(t),n.d(t,{MFE_EVENTS:function(){return E},default:function(){return h}});var r=n("c66f4a5f"),i=n("f80eb00f"),a=n("d0fefcf5"),o=n("41c6c66e"),c=n("017725b3"),l=n("ead71eb0"),u=n.n(l),s=n("28dbd132");const d=s.exp`OOGbIFBUcJZLJHNZGCfMefFBKXe`,f=s.exp`OOGbCDOTdfdcfEBNQKLDTLZOXRT`;var b=n("c0e70472"),v=n("400b7a42"),p=n("43a4d203");function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.SiteType.WWW;if(void 0===e)return{};const r={},i=e,a=e;return Object.keys(t).forEach((e=>{let t=-1;if(n===p.SiteType.WWW){const n=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("_"),t=Number(e[0]);return isNaN(t)?0:Number(e[0])??0}(e);t=i[n]??-1}else if(n===p.SiteType.MDOT){var o;t=(null===(o=a[e])||void 0===o||null===(o=o.bedPreference)||void 0===o?void 0:o[0])??-1}-1!==t&&(r[e]=t)})),r}var m=n("928dcb03");var g=e=>{let{debugMessage:t="",error:n}=e;return Boolean(function(){const e=s.exp`OOGbIFBUcJZLJHNZGCfMefFBKVPWTET`,t=s.exp`OOGbCDOTdfdcfEBNQKLDTLZOXJEHSFO`;return(0,s.trackExperiment)(e)||(0,s.trackExperiment)(t)}()>0)?t?u().createElement("h1",null,t):n?u().createElement(u().Fragment,null,u().createElement("h1",null,"Basket threw an error "),u().createElement("pre",null,JSON.stringify(n))):u().createElement(u().Fragment,null):null};const E={RT_CREATE_BASKET:"CAPLA_EVENT_property-web_property-page_RT_CREATE_BASKET",RT_SEND_BASKET_ID:"CAPLA_EVENT_property-web_property-page_RT_SEND_BASKET_ID"};var h=()=>{let e="";const t=(0,l.useRef)(!1),[n,{loading:s,data:h,error:_}]=(0,b.b)();var T,I;if(T=e=>{(0,r.fF)("CP: data received from aff data",e),e.isDebugRequest&&(t.current=!0);const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.SiteType.WWW;if("object"!==typeof e||null===e)return{};if("object"!==typeof e.blocks||null===e.blocks)return{};const n={};return Object.entries(e.blocks).forEach((e=>{let[r,i]=e,a=0;t===p.SiteType.WWW?a=(null===i||void 0===i?void 0:i.js_nr_selected)??0:t===p.SiteType.MDOT&&(a=(null===i||void 0===i?void 0:i.count)??0),n[r]=a})),n}(null===e||void 0===e?void 0:e.selection,null===e||void 0===e?void 0:e.siteType);if(0===Object.keys(i).length)return(0,o.reportWarning)("\n        [mrt] RT Basket Integrator error\n        ERROR: Selection payload is empty\n      "),void a.eventBus.publish(E.RT_SEND_BASKET_ID,{basketId:""});const l=k(null===e||void 0===e?void 0:e.bedPreferences,i,null===e||void 0===e?void 0:e.siteType),u=(0,v.D2)({selection:i,bedPreferences:l,checkinDate:e.checkinDate??"",checkoutDate:e.checkoutDate??"",aid:e.aid||0,label:e.label??"",searchConfig:e.searchConfig,hotelId:e.hotelId||0,channelId:e.channelId||0}).map(v.SV),s={input:{creator:c.WNb.ACCOMMODATION,bookerId:(0,m.G)(),basketItems:u}};n({variables:s})},(0,l.useEffect)((()=>{(0,r.fF)("CP: subscribing to receive basket requests from AFF");const e=a.eventBus.subscribe(E.RT_CREATE_BASKET,((e,t)=>{(0,r.fF)("CP: received basket request from AFF","data",t),T(t)}));return()=>a.eventBus.unsubscribe(e)}),[T]),s){const e="Waiting for basket API result...";return(0,r.fF)(e),u().createElement(g,{debugMessage:e})}if(_)return(0,o.reportWarning)(`\n      [mrt] RT Basket Integrator error\n      ERROR: ${_.message}\n    `),a.eventBus.publish(E.RT_SEND_BASKET_ID,{basketId:""}),u().createElement(g,{error:_});h&&(e=(null===(I=h.createBasket)||void 0===I?void 0:I.basketId)??"[not found]",(0,r.fF)("CP: getting response from basket API",e),t.current||a.eventBus.publish(E.RT_SEND_BASKET_ID,{basketId:e}));const O=`Basket Integrator (basket ID from basket server): ${e}`;return(0,r.fF)("CP: "+O),u().createElement(u().Fragment,null,u().createElement(i.ExpOnViewTracker,{experimentTag:d,stage:2}),u().createElement(i.ExpOnViewTracker,{experimentTag:f,stage:2}),u().createElement(g,{debugMessage:O}),";")}},"400b7a42":function(e,t,n){n.d(t,{D2:function(){return c},SV:function(){return l},bl:function(){return u}});var r=n("017725b3"),i=n("dc6d28ff"),a=n("a8619b3d"),o=n("928dcb03");function c(e){let{selection:t,aid:n,label:r,checkinDate:i,checkoutDate:a,searchConfig:o={b_adults_total:0,b_children_ages_total:[]},hotelId:c,channelId:l,bedPreferences:u={}}=e;const s=[];return Object.entries(t).forEach((e=>{let[t,d]=e;u[t];for(let u=0;u<d;u++){const e={aid:n,label:r,search:{checkin:i,checkout:a,numberOfAdults:(null===o||void 0===o?void 0:o.b_adults_total)??0,childrenAges:(null===o||void 0===o?void 0:o.b_children_ages_total)??[],userSearchConfig:JSON.stringify(o)},offer:{hotelId:Number(c),blockId:t,channelId:Number(l)}};s.push(e)}})),s}function l(e){return function(e){return{productType:r.qrQ.ACCOMMODATION,funnelPayload:e}}(function(e){const t={propertyPagePayload:e};return JSON.stringify(t)}(e))}function u(e,t){const n=function(e,t){var n,r,o;const c=(0,i.getRequestContext)().getBasePageUrl(),l=(0,a.K0)(c),u=(0,i.getRequestContext)(),s=(null===(n=u.getAffiliate())||void 0===n?void 0:n.id)??0,d=(null===(r=u.getAffiliate())||void 0===r?void 0:r.partnerChannelId)??0,f=(null===(o=u.getAffiliate())||void 0===o?void 0:o.label)??"",b=[];return e.forEach((e=>{let{blockId:n,count:r,preferences:i}=e;null===i||void 0===i||i.bed;for(let c=0;c<r;c++){var a,o;const e={aid:s,label:f,search:{checkin:(null===(a=l.searchConfigDate)||void 0===a?void 0:a.checkin)||"",checkout:(null===(o=l.searchConfigDate)||void 0===o?void 0:o.checkout)||"",numberOfAdults:null===l||void 0===l?void 0:l.nbAdults,childrenAges:(null===l||void 0===l?void 0:l.childrenAges)??[],userSearchConfig:JSON.stringify(l)},offer:{hotelId:Number(t),blockId:n,channelId:Number(d)}};b.push(e)}})),b}(e,t),c=n.map(l);return{input:{creator:r.WNb.ACCOMMODATION,bookerId:(0,o.G)(),basketItems:c}}}},"928dcb03":function(e,t,n){n.d(t,{G:function(){return i}});var r=n("dc6d28ff");function i(){var e;const t=null===(e=(0,r.getRequestContext)().getUserIdentity())||void 0===e?void 0:e.userId;return Boolean(t)?String(t):""}}}]);
//# sourceMappingURL=https://istatic.booking.com/internal-static/capla/static/js/04da5492.2974754e.chunk.js.map